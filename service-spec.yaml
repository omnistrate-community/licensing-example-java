# yaml-language-server: $schema=https://api.omnistrate.cloud/2022-09-01-00/schema/service-spec-schema.json
# yaml-language-server: $schema=https://api.omnistrate.cloud/2022-09-01-00/schema/system-parameters-schema.json

name: licensing-example-java

services:
  - name: licensing-example-java
    endpointConfiguration:
      cluster:
        host: "$sys.network.externalClusterEndpoint"
        ports:
          - 8080
        primary: true
        networkingType: PUBLIC
    helmChartConfiguration:
      chartName: licensing-example-java
      chartVersion: 1.6.0
      chartRepoName: licensing-example-java
      chartRepoURL: https://github.com/omnistrate-community/licensing-example-java
      chartValues:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: omnistrate.com/managed-by
                    operator: In
                    values:
                    - omnistrate
                  - key: topology.kubernetes.io/region
                    operator: In
                    values:
                    - $sys.deploymentCell.region
                  - key: node.kubernetes.io/instance-type
                    operator: In
                    values:
                    - $sys.compute.node.instanceType
                  - key: omnistrate.com/resource
                    operator: In
                    values:
                    - $sys.deployment.resourceID
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                - key: omnistrate.com/schedule-mode
                  operator: In
                  values:
                  - exclusive
              namespaceSelector: {}
              topologyKey: kubernetes.io/hostname